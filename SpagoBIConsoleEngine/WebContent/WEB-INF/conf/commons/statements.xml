<?xml version="1.0" encoding="ISO-8859-1"?>
<STATEMENTS>	 		

  <!-- start statements for test console -->	
  	<STATEMENT name="UPDATE_MONITOR_STATE_TEST" 
  			   query="UPDATE TEST_CONSOLE SET FLG1 = ? WHERE ID = ? "/>	
  			   
	<STATEMENT name="UPDATE_CHECK_STATE_TEST" 
  			   query="UPDATE TEST_CONSOLE SET FLG6 = ? WHERE ID = ? "/>	 
  			   
   <STATEMENT name="UPDATE_ERROR_STATE_TEST" 
  			   query="UPDATE TEST_CONSOLE SET FLG3 = ? WHERE ID = ? "/>	 
  			   
   <STATEMENT name="UPDATE_ALARM_STATE_TEST" 
  			   query="UPDATE TEST_CONSOLE SET FLG5 = ? WHERE ID = ? "/>	  			 
  			   
   <STATEMENT name="UPDATE_ALL_ERRORS_STATE_TEST" 
  			   query="UPDATE TEST_CONSOLE  SET FLG3 = ?, COLUMN3 = ? 
  			   		  WHERE  FLG2 = 1  
  			   		  AND COLUMN1 like ? and COLUMN2 like ? "/>	
  			   
   <STATEMENT name="UPDATE_ALL_ALARMS_STATE_TEST" 
  			   query="UPDATE TEST_CONSOLE  SET FLG5 = ?, COLUMN3 = ? 
  			   		  WHERE  FLG4 = 1  
  			   		  AND COLUMN1 like ? and COLUMN2 like ? "/>	
  			   
   <STATEMENT name="UPDATE_ALL_VIEWING_STATE_TEST" 
  			   query="UPDATE TEST_CONSOLE  SET FLG6 = ?, COLUMN3 = ?
  			    	  WHERE COLUMN1 like ? and COLUMN2 like ? "/>	
  <!-- end statements for test console -->

<!--  test for ENEL -->

	<STATEMENT name="UPDATE_SELEZIONE_SCARTI" 
  			   query="UPDATE BPM_SCARTI 
                  SET FLAG_SELEZIONE = DECODE(?,0,-1,1),
                  LAST_UPDATE = SYSTIMESTAMP
                  WHERE ID_SCARTO_BPM = ? "/>	
                 <!-- 
  	<STATEMENT name="UPDATE_SCARTI_OK" 
  			   query="UPDATE BPM_SCARTI 
                  SET RICHIESTA_RILAVORAZ_MANUALE = 'CORR', CAUSALE = 'CORRETTA RILAVORAZIONE OUT',
                  LAST_UPDATE = SYSTIMESTAMP
                  WHERE ID_SCARTO_BPM = ? "/>	
  			   
	<STATEMENT name="UPDATE_SCARTI_KO" 
  			     query="UPDATE BPM_SCARTI 
                  SET RICHIESTA_RILAVORAZ_MANUALE = 'ERR', CAUSALE = 'ERRATA RILAVORAZIONE OUT',
                  LAST_UPDATE = SYSTIMESTAMP
                  WHERE ID_SCARTO_BPM = ? "/>	
  			  -->
   <STATEMENT name="UPDATE_ALL_SCARTI_OK" 
  			   query="UPDATE BPM_SCARTI
                  SET RICHIESTA_RILAVORAZ_MANUALE = 'CORR', CAUSALE = 'CORRETTA RILAVORAZIONE OUT',
                      LAST_UPDATE = SYSTIMESTAMP ,
                      FLAG_SELEZIONE = -1
                  WHERE ID_SCARTO_BPM IN 
                  (
                  SELECT S.ID_SCARTO_BPM 
                  FROM BPM_SCARTI S, ANAGRAFICA_CODICI_SCARTI ACS,
                   (select row_number() over (partition by ID_SCARTO_BPM order by DATA_SCARTO_DATE DESC) rn , ID_SCARTO_BPM, STATO from BPM_SCARTI_STEP )  STATI_STEP
                   WHERE 
                  S.CODICE = ACS.CODICE (+)
                  AND S.SISTEMA = ACS.SISTEMA (+)
                  AND S.PROCESSO = ACS.PROCESSO (+)
                  AND S.SERVIZIO = ACS.SERVIZIO (+)
                  AND STATI_STEP.ID_SCARTO_BPM = S.ID_SCARTO_BPM
                  AND STATI_STEP.RN = 2 
                  AND (? = '%' OR S.ID_ATTIVITA_BARRA = ?)
                  AND (? = '%' OR S.NUMERO_UTENTE = ?)
                  AND (? = '%' OR S.POD = ?)
                  AND (? = '%'  OR S.PROCESSO = ?)
                  AND (? = '%' OR S.SERVIZIO= ?)
			      AND (? = '%'  OR ACS.CATEGORIA =?)
                  AND (? = '%' OR S.SISTEMA = ?)
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &gt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR S.MOTIVO_LETTURA = ?)
                  AND (? = '%' OR S.CODICE= ?)
                  AND (? = '%' OR ACS.TIPOLOGIA= ?)
                  AND (? = '%' OR S.KEY_2 = ?)
                  AND (? = '%' OR S.KEY_9 = ?)
                  AND (? = '%' OR S.KEY_10 = ?)
                  AND (? = '%' OR S.ECCEZIONE = ?)
   				  AND (? = '31/12/9999' OR S.START_DATE &gt; TO_DATE(?,'DD/MM/YYYY'))
   				  AND (? = '31/12/9999' OR S.START_DATE &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR STATI_STEP.STATO = ?)
                  AND S.STATO = 'EVIDENZIATO'
                  AND S.FLAG_SELEZIONE = 1
                  ) "/>	
  			   
  			   
   <STATEMENT name="UPDATE_ALL_SCARTI_KO" 
  			  query="UPDATE BPM_SCARTI
                SET RICHIESTA_RILAVORAZ_MANUALE = 'ERR',CAUSALE = 'ERRATA RILAVORAZIONE OUT',
                    LAST_UPDATE = SYSTIMESTAMP ,
                    FLAG_SELEZIONE = -1
                WHERE ID_SCARTO_BPM IN 
                (
                SELECT S.ID_SCARTO_BPM 
                FROM BPM_SCARTI S, ANAGRAFICA_CODICI_SCARTI ACS,
                 (select row_number() over (partition by ID_SCARTO_BPM order by DATA_SCARTO_DATE DESC) rn , ID_SCARTO_BPM, STATO from BPM_SCARTI_STEP )  STATI_STEP
                WHERE 
                  S.CODICE = ACS.CODICE (+)
                  AND S.SISTEMA = ACS.SISTEMA (+)
                  AND S.PROCESSO = ACS.PROCESSO (+)
                  AND S.SERVIZIO = ACS.SERVIZIO (+)
                  AND STATI_STEP.ID_SCARTO_BPM = S.ID_SCARTO_BPM
                  AND STATI_STEP.RN = 2 
                  AND (? = '%' OR S.ID_ATTIVITA_BARRA = ?)
                  AND (? = '%' OR S.NUMERO_UTENTE = ?)
                  AND (? = '%' OR S.POD = ?)
                  AND (? = '%'  OR S.PROCESSO = ?)
                  AND (? = '%' OR S.SERVIZIO= ?)
				  AND (? = '%'  OR ACS.CATEGORIA =?)
                  AND (? = '%' OR S.SISTEMA = ?)
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &gt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR S.MOTIVO_LETTURA = ?)
                  AND (? = '%' OR S.CODICE= ?)
                  AND (? = '%' OR ACS.TIPOLOGIA= ?)
                  AND (? = '%' OR S.KEY_2 = ?)
                  AND (? = '%' OR S.KEY_9 = ?)
                  AND (? = '%' OR S.KEY_10 = ?)
                  AND (? = '%' OR S.ECCEZIONE = ?)			  
   		  		  AND (? = '31/12/9999' OR S.START_DATE &gt; TO_DATE(?,'DD/MM/YYYY'))
   		  		  AND (? = '31/12/9999' OR S.START_DATE &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR STATI_STEP.STATO = ?)
                  AND S.STATO = 'EVIDENZIATO'
                  AND S.FLAG_SELEZIONE = 1
                )"/>			 
  			   
  	<STATEMENT name="SELEZIONA_SCARTI" 
  			   query="UPDATE BPM_SCARTI
                  SET FLAG_SELEZIONE = 1,
                      LAST_UPDATE = SYSTIMESTAMP 
                  WHERE ID_SCARTO_BPM IN 
                  (
                  SELECT S.ID_SCARTO_BPM 
                  FROM BPM_SCARTI S, ANAGRAFICA_CODICI_SCARTI ACS,
                   (select row_number() over (partition by ID_SCARTO_BPM order by DATA_SCARTO_DATE DESC) rn , ID_SCARTO_BPM, STATO from BPM_SCARTI_STEP )  STATI_STEP
                   WHERE 
                  S.CODICE = ACS.CODICE (+)
                  AND S.SISTEMA = ACS.SISTEMA (+)
                  AND S.PROCESSO = ACS.PROCESSO (+)
                  AND S.SERVIZIO = ACS.SERVIZIO (+)
                  AND STATI_STEP.ID_SCARTO_BPM = S.ID_SCARTO_BPM
                  AND STATI_STEP.RN = 2 
                  AND (? = '%' OR S.ID_ATTIVITA_BARRA = ?)
                  AND (? = '%' OR S.NUMERO_UTENTE = ?)
                  AND (? = '%' OR S.POD = ?)
                  AND (? = '%'  OR S.PROCESSO = ?)
                  AND (? = '%' OR S.SERVIZIO= ?)
			      AND (? = '%'  OR ACS.CATEGORIA =?)
                  AND (? = '%' OR S.SISTEMA = ?)
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &gt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR S.MOTIVO_LETTURA = ?)
                  AND (? = '%' OR S.CODICE= ?)
                  AND (? = '%' OR ACS.TIPOLOGIA= ?)
                  AND (? = '%' OR S.KEY_2 = ?)
                  AND (? = '%' OR S.KEY_9 = ?)
                  AND (? = '%' OR S.KEY_10 = ?)
                  AND (? = '%' OR S.ECCEZIONE = ?)
   				  AND (? = '31/12/9999' OR S.START_DATE &gt; TO_DATE(?,'DD/MM/YYYY'))
   				  AND (? = '31/12/9999' OR S.START_DATE &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR STATI_STEP.STATO = ?)
                  AND S.STATO = 'EVIDENZIATO'
                ) "/>	

  	<STATEMENT name="DESELEZIONA_SCARTI" 
  			   query="UPDATE BPM_SCARTI
                  SET FLAG_SELEZIONE = -1,
                      LAST_UPDATE = SYSTIMESTAMP 
                  WHERE ID_SCARTO_BPM IN 
                  (
                  SELECT S.ID_SCARTO_BPM 
                  FROM BPM_SCARTI S, ANAGRAFICA_CODICI_SCARTI ACS,
                   (select row_number() over (partition by ID_SCARTO_BPM order by DATA_SCARTO_DATE DESC) rn , ID_SCARTO_BPM, STATO from BPM_SCARTI_STEP )  STATI_STEP
                   WHERE 
                  S.CODICE = ACS.CODICE (+)
                  AND S.SISTEMA = ACS.SISTEMA (+)
                  AND S.PROCESSO = ACS.PROCESSO (+)
                  AND S.SERVIZIO = ACS.SERVIZIO (+)
                  AND STATI_STEP.ID_SCARTO_BPM = S.ID_SCARTO_BPM
                  AND STATI_STEP.RN = 2 
                  AND (? = '%' OR S.ID_ATTIVITA_BARRA = ?)
                  AND (? = '%' OR S.NUMERO_UTENTE = ?)
                  AND (? = '%' OR S.POD = ?)
                  AND (? = '%'  OR S.PROCESSO = ?)
                  AND (? = '%' OR S.SERVIZIO= ?)
			      AND (? = '%'  OR ACS.CATEGORIA =?)
                  AND (? = '%' OR S.SISTEMA = ?)
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &gt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR S.MOTIVO_LETTURA = ?)
                  AND (? = '%' OR S.CODICE= ?)
                  AND (? = '%' OR ACS.TIPOLOGIA= ?)
                  AND (? = '%' OR S.KEY_2 = ?)
                  AND (? = '%' OR S.KEY_9 = ?)
                  AND (? = '%' OR S.KEY_10 = ?)
                  AND (? = '%' OR S.ECCEZIONE = ?)
   				  AND (? = '31/12/9999' OR S.START_DATE &gt; TO_DATE(?,'DD/MM/YYYY'))
   				  AND (? = '31/12/9999' OR S.START_DATE &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR STATI_STEP.STATO = ?)
                  AND S.STATO = 'EVIDENZIATO'
                ) "/>	
                
    <STATEMENT name="INVERTI_SELEZIONE_SCARTI" 
  			   query="UPDATE BPM_SCARTI
                  SET FLAG_SELEZIONE = (FLAG_SELEZIONE * -1),
                      LAST_UPDATE = SYSTIMESTAMP 
                  WHERE ID_SCARTO_BPM IN 
                  (
                  SELECT S.ID_SCARTO_BPM 
                  FROM BPM_SCARTI S, ANAGRAFICA_CODICI_SCARTI ACS,
                   (select row_number() over (partition by ID_SCARTO_BPM order by DATA_SCARTO_DATE DESC) rn , ID_SCARTO_BPM, STATO from BPM_SCARTI_STEP )  STATI_STEP
                   WHERE 
                  S.CODICE = ACS.CODICE (+)
                  AND S.SISTEMA = ACS.SISTEMA (+)
                  AND S.PROCESSO = ACS.PROCESSO (+)
                  AND S.SERVIZIO = ACS.SERVIZIO (+)
                  AND STATI_STEP.ID_SCARTO_BPM = S.ID_SCARTO_BPM
                  AND STATI_STEP.RN = 2 
                  AND (? = '%' OR S.ID_ATTIVITA_BARRA = ?)
                  AND (? = '%' OR S.NUMERO_UTENTE = ?)
                  AND (? = '%' OR S.POD = ?)
                  AND (? = '%'  OR S.PROCESSO = ?)
                  AND (? = '%' OR S.SERVIZIO= ?)
			      AND (? = '%'  OR ACS.CATEGORIA =?)
                  AND (? = '%' OR S.SISTEMA = ?)
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &gt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR TO_DATE(S.DATA_LETTURA,'YYYYMMDD') &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR S.MOTIVO_LETTURA = ?)
                  AND (? = '%' OR S.CODICE= ?)
                  AND (? = '%' OR ACS.TIPOLOGIA= ?)
                  AND (? = '%' OR S.KEY_2 = ?)
                  AND (? = '%' OR S.KEY_9 = ?)
                  AND (? = '%' OR S.KEY_10 = ?)
                  AND (? = '%' OR S.ECCEZIONE = ?)
   				  AND (? = '31/12/9999' OR S.START_DATE &gt; TO_DATE(?,'DD/MM/YYYY'))
   				  AND (? = '31/12/9999' OR S.START_DATE &lt; TO_DATE(?,'DD/MM/YYYY'))
                  AND (? = '%' OR STATI_STEP.STATO = ?)
                  AND S.STATO = 'EVIDENZIATO'
                ) "/>	
   
<!--  fine test for ENEL -->
  			
</STATEMENTS>